<!--
@license
Code developed by Dorian Brown in collaboration with Codeself, Inc.
-->

<!-- Polymer -->
<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<!-- Paper Elements -->
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<!-- Iron Elements -->
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">

<!-- Polymerfire Elements -->
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">

<!-- Vaadin Elements -->
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-grid.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../bower_components/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-column.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-sorter.html">
<!-- <link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-checkbox.html">-->
<!--<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-selection-column.html"> -->

<!-- Paper Elements -->
<link rel="import" href="../../bower_components/paper-search/paper-search-bar.html">
<link rel="import" href="../../bower_components/paper-search/paper-search-panel.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">

<!-- Polyfilter -->
<link rel="import" href="../../bower_components/poly-filter/poly-filter-diacritic.html">

<!-- Suji Elements -->
<link rel="import" href="../suji/lib/themes/azul/azul-theme.html">
<link rel="import" href="../suji/lib/colors/suji-color-palette.html">

<!-- Neon Elements -->
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">

<!-- Icons -->
<link rel="import" href="../app-icons.html">
<link rel="import" href="../fa-icons.html">

<dom-module id="wrc-athletes">
    <template>
        <style>
            /* General Style */
            main {
                padding: 2em 3em;
                height: calc(100vh - (64px + 4em));
                min-height: calc(100vh - (64px + 4em));
                overflow: auto;

                @apply --layout-vertical;
                @apply --layout-center;
            }

            paper-spinner {
                --paper-spinner-layer-1-color: var(--azul-primary);
                --paper-spinner-layer-2-color: var(--azul-primary);
                --paper-spinner-layer-3-color: var(--azul-primary);
                --paper-spinner-layer-4-color: var(--azul-primary);
            }

            /* header wrapper */
            div.wrapper-horizontal {
                @apply --layout-horizontal;
            }

            [flex] {
                @apply --layout-flex;
            }

            /* Empty Message */
            .empty-message {
                width: 100%;
                height: inherit;

                @apply --layout-vertical;
                @apply --layout-center-center;
            }

            .empty-message .icon-container {
                border-radius: 300em;
                width: 200px;
                height: 200px;
                background-color: var(--azul-text-title);
                box-shadow: 0 3.5px 12.5px 0 rgba(0, 0, 0, 0.25);

                @apply --layout-vertical;
                @apply --layout-center-center;
            }

            .icon-container iron-icon {
                color: #fff;
                width: 90px;
                height: 90px;
            }

            .empty-message p {
                margin-top: 24px;
                text-align: center;

                @apply --layout-vertical;
                @apply --layout-center-center;
            }

            .empty-message p strong {
                font-size: 1.2em;
                font-weight: bold;
                color: var(--azul-text-title);
                margin-bottom: 15px;
                text-align: center;
            }

            .empty-message p span {
                font-size: 1em;
                font-weight: lighter;
                color: var(--paper-grey-600);
                margin-bottom: 24px;
                text-align: center;
            }

            .empty-message p paper-button {
                margin: 0;
                color: #fff;
                background-color: var(--azul-primary);
            }

            /* Athletes Wrapper */
            div.athletes-wrapper {
                width: 100%;
            }

            div.athletes-wrapper[hidden] {
                display: none;
            }

            /* Search Style */
            div.search-wrapper {
                width: 96%;
                margin-bottom: 24px;
            }

            div.search-wrapper vaadin-text-field {
                width: 100%;
            }

            div.search-wrapper vaadin-text-field [slot='prefix']{
                margin-right: 12px;
                color: var(--paper-grey-500);
            }

            /* Grid Wrapper */
            div.grid-wrapper {
                width: 100%;
            }

            div.grid-wrapper vaadin-grid {
                width: inherit;
                height: auto;
                @apply --azul-shadow--grid-elevation-1;
            }

            div.grid-wrapper vaadin-grid iron-icon {
				        width: 17px;
                height: 17px;
			      }

      			div.grid-wrapper vaadin-grid iron-icon[active='Yes'] {
      				color: #35BF2E;
      			}

      			div.grid-wrapper vaadin-grid iron-icon[active='No'] {
      				color: var(--paper-grey-500);
      			}

            div.grid-wrapper vaadin-grid vaadin-grid-cell-content div.actions {
      				@apply --layout-horizontal;
      				@apply --layout-wrap;
      				@apply --layout-end-justified;
    			  }

      			div.grid-wrapper vaadin-grid vaadin-grid-cell-content div.actions paper-icon-button {
      				color: #737D8A;
      			}

      			div.grid-wrapper vaadin-grid vaadin-grid-cell-content div.actions paper-icon-button:hover {
      				color: #425164;
      			}

            /* Vaadin Grid  */
            div.grid-wrapper vaadin-grid {
              height: auto;
              @apply --azul-shadow--grid-elevation-1;
            }

            div.grid-wrapper vaadin-grid iron-icon {
              width: 15px;
              height: 15px;
            }

            div.grid-wrapper vaadin-grid iron-icon[active='Yes'] {
              color: #35BF2E;
            }

            div.grid-wrapper vaadin-grid iron-icon[active='No'] {
              color: var(--paper-grey-500);
            }

            div.grid-wrapper vaadin-grid vaadin-grid-cell-content div.actions {
              @apply --layout-horizontal;
              @apply --layout-wrap;
              @apply --layout-end-justified;
            }

            div.grid-wrapper vaadin-grid vaadin-grid-cell-content div.actions paper-icon-button {
              color: #737D8A;
            }

            div.grid-wrapper vaadin-grid vaadin-grid-cell-content div.actions paper-icon-button:hover {
              color: #425164;
            }

            /* Cards Wrapper */
            div.cards-wrapper {
                width: 100%;

                @apply --layout-vertical;
                @apply --layout-center-center;
            }

            div.cards-wrapper paper-card {
                width: 100%;
                margin-bottom: 24px;

                @apply --azul-shadow--grid-elevation-1;
            }

            div.cards-wrapper paper-card div.card-content {
                padding: 1em 1em;

                @apply --layout-horizontal;
                @apply --layout-center;
            }

            div.cards-wrapper paper-card div.card-actions {
                @apply --layout-horizontal;
                @apply --layout-end-justified;
            }

            div.cards-wrapper paper-card div.card-actions paper-icon-button {
                color: #737D8A;
            }

            paper-card div.card-content div.profile-picture {
                background-color: #F3F4F5;
				        overflow: hidden;
				        border-radius: 10em;
				        width: 70px;
				        height: 70px;
                box-shadow: 0 3.5px 12.5px 0 rgba(0, 0, 0, 0.25);
                margin-right: 12px;
            }

            paper-card div.card-content div.profile-picture iron-image {
                overflow: hidden;
                border-radius: 10em;
                width: 100%;
                height: 100%;
                z-index: 0;
            }

            paper-card div.card-content div.legend h3 {
                margin: 0;
                color: var(--azul-text-title);
                font-size: 1.1em;

                @apply --layout-horizontal;
                @apply --layout-center;
            }

            paper-card div.card-content div.legend h3 iron-icon {
                width: 15px;
                height: 15px;
                margin-right: 5px;
            }

            paper-card div.card-content div.legend h3 iron-icon[active='Yes'] {
				      color: #35BF2E;
			      }

			      paper-card div.card-content div.legend h3 iron-icon[active='No'] {
				      color: var(--paper-grey-500);
			      }

            paper-card div.card-content div.legend p {
                margin: 0;
                font-size: .9em;
                color: var(--paper-grey-700);
            }

            /* Fab */
            paper-fab {
                position: fixed;
                bottom: 2em;
                right: 2em;

                --paper-fab-background: var(--azul-primary);
                --paper-fab-keyboard-focus-background: var(--azul-primary);
            }

            /* Responsive */
            @media screen and (max-width: 425px) {
                /* General Style */
                main {
                    padding: 1em;
                    height: calc(100vh - (64px + 2em));
                    min-height: calc(100vh - (64px + 2em));

                    @apply --layout-vertical;
                    @apply --layout-center;
                }

                paper-fab {
                    bottom: 1em;
                    right: 1em;
                }
            }

            [hidden] {
                display: none;
            }
        </style>

        <!-- This media query matches small screens to hide the grid and show responsive cards -->
        <iron-media-query query="(max-width: 600px)" query-matches="{{responsiveScreen}}"></iron-media-query>

        <!-- Firebase Document Configuration -->
        <firebase-document
            id="firebaseDocument"
            app-name="wrc_software"></firebase-document>

        <main>
            <template is="dom-if" if="[[!userReady]]">
                <paper-spinner active></paper-spinner>
            </template>

            <!-- Empty Teams Message -->
            <div class="empty-message" hidden$="[[!_computeVisibleEmptyMessage(athletesData.length, userReady)]]">
                <div class="icon-container">
                    <iron-icon icon="app-icons:person"></iron-icon>
                </div>
                <p>
                    <strong>You don't have athletes</strong>
                    <span>Add an athlete and it will show up here</span>
                    <paper-button raised on-tap="_openToAdd">Add Athlete</paper-button>
                </p>
            </div>

            <!-- Athletes Wrapper -->
            <div class="athletes-wrapper" hidden$="[[!_computeVisibleData(athletesData.length, userReady)]]">

              <div class="wrapper-horizontal">
                <!-- Search filter -->
                <div class="search-wrapper">
                    <!-- Polyfilter configuration -->
                    <poly-filter-diacritic
                        filter="[[athleteFilter]]"
                        array-to-filter="[[athletesData]]"
                        filtered-array="{{athletesDataFiltered}}"
                        filter-by="first, last"></poly-filter-diacritic>
                    <!-- Search bar -->
                    <paper-search-bar query="{{athleteFilter}}" hideFilterButton=true> </paper-search-bar>
                  </div>

                  <!-- printer -->
                  <paper-icon-button noink icon="fa-icons:pdf" on-tap='_printPdfCollection'></paper-icon-button>
              </div>

                <!-- Grid View -->
                <template is="dom-if" if="[[!responsiveScreen]]">
                    <div class="grid-wrapper">
                        <vaadin-grid aria-label="Coaches Grid" items="[[athletesDataFiltered]]">
                          <!-- Active -->
                          <vaadin-grid-column width="100px" flex-grow="0">
                              <template class="header">

                                  <vaadin-grid-sorter path="active" active$="[[item.profile.active]]">Active</vaadin-grid-sorter>
                              </template>
                              <template>

                                 <paper-toggle-button id$="[[item.$key]]" noink checked="{{_computeActiveToggle(item.profile.active)}}" status$="[[item.profile.active]]" on-change="_changeAthleteActiveStatus"></paper-toggle-button>
                                  <!--<toggle-icon icon="app-icons:dot" active$="[[item.profile.active]]"></toggle-icon> -->
                              </template>
                          </vaadin-grid-column>

                            <!-- Athlete number -->
                            <vaadin-grid-column width="70px" flex-grow="0">
                                <template class="header">
                                    <vaadin-grid-sorter path="number">#</vaadin-grid-sorter>
                                </template>
                                <template>[[item.profile.number]]</template>
                            </vaadin-grid-column>

                            <!-- First Name -->
                            <vaadin-grid-column>
                                <template class="header">
                                    <vaadin-grid-sorter path="first">First</vaadin-grid-sorter>
                                </template>
                                <template>[[item.profile.first]]</template>
                            </vaadin-grid-column>

                            <!-- Last Name -->
                            <vaadin-grid-column>
                                <template class="header">
                                    <vaadin-grid-sorter path="last">Last</vaadin-grid-sorter>
                                </template>
                                <template>[[item.profile.last]]</template>
                            </vaadin-grid-column>

                            <!-- Position -->
                            <vaadin-grid-column>
                                <template class="header">
                                    <vaadin-grid-sorter path="pos">Position</vaadin-grid-sorter>
                                </template>
                                <template>[[item.profile.pos]]</template>
                            </vaadin-grid-column>

                            <!-- Year -->
                            <vaadin-grid-column width="100px" flex-grow="0">
                                <template class="header">
                                    <vaadin-grid-sorter path="year">Year</vaadin-grid-sorter>
                                </template>
                                <template>[[item.profile.year]]</template>
                            </vaadin-grid-column>

                            <!-- Actions -->
                            <vaadin-grid-column>
                                <template class="horizontal-layout">
                                    <div class="actions">
                                        <paper-icon-button id$="[[item.$key]]" noink icon="fa-icons:player-card" on-tap="_openAthleteProfileDialog"></paper-icon-button>
                                        <paper-icon-button id$="[[item.$key]]" noink icon="fa-icons:clipboard" on-tap="_openStatsDialog"></paper-icon-button>
                                        <paper-icon-button id$="[[item.$key]]" noink icon="fa-icons:pdf" on-tap="_generateStatsPDF" first$="[[item.profile.first]]" last$="[[item.profile.last]]" number$="[[item.profile.number]]"></paper-icon-button>
                                        <!-- <paper-icon-button id$="[[item.$key]]" noink icon="fa-icons:file-edit" on-tap="_openToEdit"></paper-icon-button> -->
                                    </div>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid>
                    </div>
                </template>

                <!-- Cards View -->
                <template is="dom-if" if="[[responsiveScreen]]">
                    <div class="cards-wrapper">
                        <template is="dom-repeat" items="[[athletesDataFiltered]]" as="athlete">
                            <paper-card>
                                <div class="card-content">
                                    <div class="profile-picture">
                                        <iron-image
                                            fade
                                            preload
                                            sizing="cover"
                                            src="[[athlete.profile.profile_pic_url]]"></iron-image>
                                    </div>
                                    <div class="legend">
                                        <h3>
                                            <iron-icon icon="app-icons:dot" active$="[[athlete.profile.active]]"></iron-icon>
                                            [[athlete.profile.first]] [[athlete.profile.last]]
                                        </h3>
                                        <p>#[[athlete.profile.number]] - [[athlete.profile.year]] - [[athlete.profile.pos]]</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <paper-icon-button id$="[[athlete.$key]]" noink icon="fa-icons:player-card" on-tap="_openAthleteProfileDialog"></paper-icon-button>
                                    <paper-icon-button id$="[[athlete.$key]]" noink icon="fa-icons:clipboard" on-tap="_openStatsDialog"></paper-icon-button>
                                    <paper-icon-button id$="[[athlete.$key]]" noink icon="fa-icons:pdf" on-tap="_generateStatsPDF"></paper-icon-button>
                                </div>
                            </paper-card>
                        </template>
                    </div>
                </template>
            </div>

            <!-- Paper Fab to add new athlete -->
            <paper-fab icon="app-icons:person-add" on-tap="_openToAdd" hidden$="[[!_computeVisibleData(athletesData.length, userReady)]]"></paper-fab>
        </main>
    </template>

    <!-- pdfMake script -->
    <script src="../../bower_components/pdfmake/build/pdfmake.min.js"></script>
    <script src="../../bower_components/pdfmake/build/vfs_fonts.js"></script>

    <script>
        (function() {
            'use strict';

            class WrcAthletes extends Polymer.Element {
                /**
                 * Element definition
                */
                static get is() { return 'wrc-athletes'; }

                /**
                 * Element properties
                */
                static get properties() {
                    return {
                        userInfo: Object,
                        userReady: {
                            type: Boolean,
                            notify: true,
                            value: false
                        },
                        user: {
                            type: Object,
                            notify: true,
                            observer: '_userChanged'
                        },
                        athletesData: {
                            type: Object,
                            notify: true
                        }
                    };
                }

                ready() {
                    super.ready();

                    // Athletes Dialog
                    this._athletesDialog = document.getElementById('athletesDialog');

                    // Athlete Profile Dialog
                    this._athleteProfileDialog = document.getElementById('athleteProfileDialog');

                    // Athlete Stats Dialog
                    this._athleteStatsDialog = document.getElementById('athleteStatsDialog');

                    // App Progress Bar
                    this._appProgressBar = document.getElementById('appProgressBar');

                    // App Toast
                    this._appToast = document.getElementById('appToast');
                }

                /**
                 * Determines if the athletes data is empty to show the message
                 *
                 * @param {Number} length of the athletes array
                 * @param {Boolean} ready status of the user
                 * @return {Boolean}
                */
                _computeVisibleEmptyMessage(length, ready) {
                    if (!ready) return false;
                    return (length > 0) ? false : true;
                }

                /**
                 * Determines if the athletes data has elements to show data
                 *
                 * @param {Number} length of the athletes array
                 * @param {Boolean} ready status of the user
                 * @return {Boolean}
                */
                _computeVisibleData(length, ready) {
                    if (!ready) return false;
                    return (length > 0) ? true : false;
                }

                /**
                 * Observers the user for changes
                 *
                 * @param {Object} user information
                 * @return {void}
                */
                _userChanged(user) {
                    if (user) {
                        this.userReady = false;
						            this.$.firebaseDocument.getStoredValue('/users')
                        .then(function (snapshot) {
                            this.userReady = true;
                        }.bind(this));
                    }
                }

                /**
                 * Opens athlete dialog to add
                */
                _openToAdd() {
                    this.action = 'add';
                    this._athletesDialog._resetForm();
                    this._athletesDialog.acceptedCallback = this._saveAthlete.bind(this);
                    this._athletesDialog.action = 'add';
                    this._athletesDialog.opened = true;
                    this._athletesDialog.user = this.user;
                }

                /**
                 * Opens athlete dialog to edit
                 *
                 * @param {Event} evt from tapped button
                 * @return {void}
                */
                _openToEdit(evt) {
                    this.athleteId = evt.target.getAttribute('id');
                    this.action = 'edit';
                    this._athletesDialog.athleteInfo = null;

                    this.$.firebaseDocument.getStoredValue(this.user.uid + '/athletes/' + this.athleteId + '/profile')
                    .then(function(snapshot) {
                        this._athletesDialog.athleteInfo = snapshot;
                        this._athletesDialog.acceptedCallback = this._saveAthlete.bind(this);
                        this._athletesDialog.action = 'edit';
                        this._athletesDialog.opened = true;
                        this._athletesDialog.user = this.user;
                    }.bind(this));
                }

                /**
                 * Saves athlete to database
                 *
                 * @param {Object} athleteInfo from dialog
                 * @return {void}
                */
                _saveAthlete(athleteInfo) {
					if (this.action === 'add') {
                        // Saves athlete in coach's private path
						this.$.firebaseDocument.setStoredValue(this.user.uid + '/athletes/' + athleteInfo.uid + '/profile', athleteInfo)
                        .then(function() {
                            // Creates athlete private node
                            this.$.firebaseDocument.setStoredValue(athleteInfo.uid + '/metadata', {'path': this.user.uid + '/athletes/' + athleteInfo.uid + '/profile', 'role': 'athlete'});

                            // Saves default maxes in athletes info
                            this.$.firebaseDocument.setStoredValue(this.user.uid + '/athletes/' + athleteInfo.uid + '/stats',
                            {
                                'bench_press_value': '0',
                                'bench_press_reps': '0',
                                'back_squat_value': '0',
                                'back_squat_reps': '0',
                                'front_squat_value': '0',
                                'front_squat_reps': '0',
                                'deadlift_value': '0',
                                'deadlift_reps': '0',
                                'hang_power_clean_value': '0',
                                'hang_power_clean_reps': '0',
                                'pull_ups': '0',
                                'forty_yard_dash': '0',
                                'three_cone_drill': '0',
                                'twenty_yard_shuttle': '0',
                                'sixty_yard_shuttle': '0',
                                'vertical_jump': '0',
                                'broad_jump': '0'
                            });
                        }.bind(this))
                        .catch(function (err) {
                            this._appToast.text = 'There has been an error. Please try again.';
                            this._appToast.open();
                        }.bind(this));

						this._athletesDialog.opened = false;
						this._appToast.text = 'The athlete has been saved successfully.';
						this._appToast.open();
						this._appProgressBar.hidden = true;
					} else {
						this.$.firebaseDocument.setStoredValue(this.user.uid + '/athletes/' + athleteInfo.uid + '/profile', athleteInfo)
                        .catch(function (err) {
                            this._appToast.text = 'There has been an error. Please try again.';
                            this._appToast.open();
                        }.bind(this));

						this._athletesDialog.opened = false;
						this._appToast.text = 'The athlete has been modified successfully.';
						this._appToast.open();
						this._appProgressBar.hidden = true;
                    }
                }

                /**
                 * Athlete's profile dialog
                */
                _openAthleteProfileDialog(e) {
                    this.athleteId = e.target.getAttribute('id');

                    this.$.firebaseDocument.getStoredValue(this.user.uid + '/athletes/' + this.athleteId + '/profile')
                    .then(function(snapshot) {
                        this._athleteProfileDialog.user = this.user;
                        this._athleteProfileDialog.athleteId = this.athleteId;
                        this._athleteProfileDialog.athleteInfo = snapshot;
                        this._athleteProfileDialog.opened = true;
                    }.bind(this), function(err) {
                        this._appToast.text = 'An error has ocurred trying to retrieve the coach data. Please try again.';
                        this._appToast.open();
                    }.bind(this));
                }

                /**
                 * Athlete' stats dialog
                */
                _openStatsDialog(e) {
                    this.athleteId = e.target.getAttribute('id');

                    this.$.firebaseDocument.getStoredValue(this.user.uid + '/athletes/' + this.athleteId + '/profile')
                    .then(function(athleteInfo) {
                        this._athleteStatsDialog.athleteInfo = athleteInfo;
                        this.$.firebaseDocument.getStoredValue(this.user.uid + '/athletes/' + this.athleteId + '/stats')
                        .then(function(athleteStats) {
                            this._athleteStatsDialog.user = this.user;
                            this._athleteStatsDialog.athleteStats = athleteStats;
                            this._athleteStatsDialog.opened = true;
                        }.bind(this));
                    }.bind(this));
                }

                /**
                 * Changes active status of the athlete in real-time from toggle-button
                */
                _changeAthleteActiveStatus(e) {
                    this.athleteId = e.target.getAttribute('id');

                    // Gets athlete's current status
                    var currentStatus = e.target.getAttribute('status');
                    var newStatus = null;

                    // Set new status depending on current status
                    newStatus = (currentStatus === 'Yes') ? 'No' : 'Yes';

                    // Save new status into firebase
                    this.$.firebaseDocument.setStoredValue(this.user.uid + '/athletes/' + this.athleteId + '/profile/active', newStatus)
                    .catch(function(err) {
                        // Catch any error from firebase
                        this._appToast.text = 'There has been an error trying to change the active status';
                        this._appToast.open();
                    }.bind(this));

                    // Open toast with successful message
                    this._appToast.text = 'Active status has been changed successfully.';
                    this._appToast.open();
                }

                /**
                 * Computes boolean status to toggle-button
                 *
                 * @param {String} active status of the athlete
                 * @return {Boolean} true if status is Yes, otherwise false
                */
                _computeActiveToggle(active) {
                    return (active === 'Yes') ? true : false;
                }






                /**
                 * Test Print all functionality
                */

                _printPdfCollection(e) {
                   var athletesData = this.athletesData;

                   console.log(this.athletesData);

                    // Retrived Data
                    function computeContent(data) {
                        // Array of content
                        var content = [];

                       /**
                        * Loop for each element in an array, in order.
                        * Note: Provide the array with any name to represent the element.
                        */
                        data.forEach(function(athlete) { //
                            // Push data (element) to array
                            content.push(
                                {
                                  text: athlete.profile.first + " " + athlete.profile.last,
                                  style: 'header',
                                },
                                {
                                  text: "Max Bench Press: " + athlete.stats.bench_press_value + "lbs",
                                  style: 'subheader',
                                  pageBreak: 'after'
                                }
                            );
                        });
                        return content;
                    }

                    // This defines the content of the PDF. For more info read: http://pdfmake.org/index.html#/gettingstarted
                    var pdfCollection = {
                        pageOrientation: 'landscape',
                        content: computeContent(athletesData),
                        styles: {
                            header: {
                                fontSize: 25,
                                bold: true,
                                margin: [ 30, 180, 10, 20 ],
                                alignment: 'center',
                                color: '#757575'
                            },

                            subheader: {
                              fontSize: 10,
                              bold: true,
                              alignment: 'center',
                              color: '#757575'
                            }
                        }
                    };

                    // This creates and opens the PDF in a new tab
                    pdfMake.createPdf(pdfCollection).open();
                }





                /**
                 * Test to create PDF
                */
                _generateStatsPDF(e) {
                    // Gets athlete id
                    this.athleteId = e.target.getAttribute('id');

                    // Gets athlete's first name
                    var first = e.target.getAttribute('first');

                    // Gets athlete's last name
                    var last = e.target.getAttribute('last');

                    // Gets athlete's number
                    var number = e.target.getAttribute('number');

                    this.$.firebaseDocument.getStoredValue(this.user.uid + '/athletes/' + this.athleteId + '/stats')
                    .then(function(athleteStats) {
                        // This defines the content of the PDF. For more info read: http://pdfmake.org/index.html#/gettingstarted
                        var statsPDF = {
                            content: [
                                {
                                    text: first + ' ' + last + ' #' + number,
                                    style: 'header'
                                },
                                {
                                    text: [
                                        {text: 'Bech Press: ', bold: true},
                                        athleteStats.bench_press_value + 'lbs x ' + athleteStats.bench_press_reps + 'reps\n\n',
                                        {text: 'Back Squat: ', bold: true},
                                        athleteStats.back_squat_value + 'lbs x ' + athleteStats.back_squat_reps + 'reps\n\n',
                                        {text: 'Front Squat: ', bold: true},
                                        athleteStats.front_squat_value + 'lbs x ' + athleteStats.front_squat_reps + 'reps\n\n',
                                        {text: 'Deadlift: ', bold: true},
                                        athleteStats.deadlift_value + 'lbs x ' + athleteStats.deadlift_reps + 'reps\n\n',
                                        {text: 'Hang / Power Clean: ', bold: true},
                                        athleteStats.hang_power_clean_value + 'lbs x ' + athleteStats.hang_power_clean_reps + 'reps\n\n',
                                        {text: 'Pull ups: ', bold: true},
                                        athleteStats.pull_ups + 'reps\n\n',
                                        {text: '40 Yard Dash: ', bold: true},
                                        athleteStats.forty_yard_dash + '\n\n',
                                        {text: '3 Cone Drill: ', bold: true},
                                        athleteStats.three_cone_drill + '\n\n',
                                        {text: '20 Yard Shuttle: ', bold: true},
                                        athleteStats.twenty_yard_shuttle + '\n\n',
                                        {text: '60 Yard Shuttle: ', bold: true},
                                        athleteStats.sixty_yard_shuttle + '\n\n',
                                        {text: 'Vertical Jump: ', bold: true},
                                        athleteStats.vertical_jump + '\n\n',
                                        {text: 'Broad Jump: ', bold: true},
                                        athleteStats.broad_jump,
                                    ]
                                }
                            ],
                            styles: {
                                header: {
                                    fontSize: 20,
                                    margin: [0, 0, 0, 14],
                                    bold: true,
                                    color: 'darkcyan'
                                }
                            }
                        };

                        // This creates and opens the PDF in a new tab
                        pdfMake.createPdf(statsPDF).open();

                        // If you want to download the PDF directly, use this:
                        // pdfMake.createPdf(statsPDF).download('stats.pdf');
                    }.bind(this));
                }
            }
            window.customElements.define(WrcAthletes.is, WrcAthletes);
        })();
    </script>
</dom-module>
